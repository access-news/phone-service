<?xml version="1.0" encoding="utf-8"?>
<include>
  <context name="default">

    <!-- 
      TODO: this should be going to public and transferred here.
      And/or external. This part is still fuzzy. Anyhow,
      just as the book describes.
    -->
    <extension name="SignalWire CONNECTORS incoming call">
      <!-- the number you assigned in your dashboard -->
      <condition field="destination_number" expression="^(\+19162510217)$">

        <action application="answer"/>
        <action application="lua" data="auth.lua"/>

        <!-- <action application="info"/> -->
        <action application="sleep" data="250"/>
        <action application="ivr" data="demo_ivr"/>
      </condition>
    </extension>

    <extension name="match Access News users">
    </extension>

    <extension name="hold_music">
      <condition field="destination_number" expression="^9664$"/>
      <condition field="${rtp_has_crypto}" expression="^(AES_CM_128_HMAC_SHA1_32|AES_CM_128_HMAC_SHA1_80)$">
        <action application="answer"/>
        <action application="execute_extension" data="is_secure XML features"/>
        <action application="playback" data="$${hold_music}"/>
        <anti-action application="set" data="zrtp_secure_media=true"/>
        <anti-action application="answer"/>
        <anti-action application="playback" data="silence_stream://2000"/>
        <anti-action application="execute_extension" data="is_zrtp_secure XML features"/>
        <anti-action application="playback" data="$${hold_music}"/>
      </condition>
    </extension>

    <extension name="laugh break">
      <condition field="destination_number" expression="^9386$">
        <action application="answer"/>
        <action application="sleep" data="1500"/>
        <action application="playback" data="phrase:funny_prompts"/>
        <action application="hangup"/>
      </condition>
    </extension>
  </context>
</include>
